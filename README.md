<h1 name="content" align="center"><a href=""><img src="https://github.com/user-attachments/assets/e080adec-6af7-4bd2-b232-d43cb37024ac" width="20" height="20"/></a> MSSQL</h1>

<p align="center">
  <a href="#-lab1"><img alt="lab1" src="https://img.shields.io/badge/Lab1-blue"></a> 
  <a href="#-lab2"><img alt="lab2" src="https://img.shields.io/badge/Lab2-red"></a>
  <a href="#-lab3"><img alt="lab3" src="https://img.shields.io/badge/Lab3-green"></a>
  <a href="#-lab4"><img alt="lab4" src="https://img.shields.io/badge/Lab4-yellow"></a>
  <a href="#-lab5"><img alt="lab5" src="https://img.shields.io/badge/Lab5-gray"></a>
  <a href="#-lab6"><img alt="lab6" src="https://img.shields.io/badge/Lab6-orange"></a> 
  <a href="#-lab7"><img alt="lab7" src="https://img.shields.io/badge/Lab7-brown"></a>
  <a href="#-lab8"><img alt="lab8" src="https://img.shields.io/badge/Lab8-purple"></a>
  <a href="#-lab9"><img alt="lab9" src="https://img.shields.io/badge/Lab9-violet"></a> 
</p>

# <img src="https://github.com/user-attachments/assets/e080adec-6af7-4bd2-b232-d43cb37024ac" width="20" height="20"/> Фирма по прокату автомобилей (Вариант №21)
<h3 align="center">
<h3">
  <a href="#client"></a>
  
Информация об автомобилях: модель, год выпуска, тип, стоимость проката в сутки,...
Информация о клиентах: ФИО, паспорт, телефон, адрес.
Информация о сделках: дата выдачи, возврата, сумма сделки (зависит от длительности срока проката). (В рамках одной сделки клиент может арендовать несколько автомобилей)

Реализовать:
- Подбор автомобиля, заключение сделки, расчет стоимости проката с учетом скидок для постоянных клиентов; 
- Возврат автомобиля в салон и расчет штрафа, если автомобиль возвращен в ненадлежащем виде или не вовремя;
- Расчет выручки пункта проката за заданный период;
- Вывод постоянных клиентов, клиентов-должников;
</h3>
</p>
<img src="https://github.com/user-attachments/assets/e080adec-6af7-4bd2-b232-d43cb37024ac" width="20" height="20"/> Лабораторная работа №1


<p aligh="justify>
<h3>
  <a href="#client"></a>
  Разработать ER-модель данной предметной области: выделить сущности, их атрибуты,
связи между сущностями.
Для каждой сущности указать ее имя, атрибут (или набор атрибутов), являющийся
первичным ключом, список остальных атрибутов.
Для каждого атрибута указать его тип, ограничения, может ли он быть пустым, является ли
он первичным ключом.
Для каждой связи между сущностями указать:
- тип связи (1:1, 1:M, M:N)
- обязательность
ER-модель д.б. представлена в виде ER-диаграммы (картинка)
По имеющейся ER-модели создать реляционную модель данных и отобразить ее в виде
списка сущностей с их атрибутами и типами атрибутов, для атрибутов указать, явл. ли он
первичным или внешним ключом
</h3>
</p3>

#### ER-модель
![image](/lab1/bd222.png)

#### Реляционная модель
![image](https://github.com/nastyandrianova/bdbd_labbs/blob/main/lab1/relmodel.jpg)

<a id="lab2"></a>

# Лабораторная работа №2

<p aligh="justify>
<h3>
  <a href="#client"></a>
В соответствии с реляционной моделью данных, разработанной в Лаб.№1, создать реляционную БД на учебном сервере БД :
- создать таблицы, определить первичные ключи и иные ограничения
- определить связи между таблицами
- создать диаграмму
- заполнить все таблицы адекватной информацией (не меньше 10 записей в таблицах, наличие примеров для связей типа 1:M )

</h3>
</p3>

[SQL-код создания таблиц](https://github.com/nastyandrianova/bdbd_labbs/blob/main/lab2/last.sql)

#### Диаграмма базы данных
![image](https://github.com/nastyandrianova/bdbd_labbs/blob/main/lab1/lab2.jpg)

# Лабораторная работа №3
[Назад](#content)

Цель: изучить конструкции языка SQL для манипулирования данными в СУБД  MSSQL.

Краткое описание работы:
1. Выборка из одной таблицы
2. Выборка из нескольких таблиц
3. Представления
4. Функции ранжирования
5. Объдинение, пересечение, разность
6. Использование CASE, PIVOT и UNPIVOT

[Часть 1](https://github.com/nastyandrianova/bdbd_labbs/blob/main/lab3/Andrianova_PMI32_Chast_1.docx)

[Часть 2](https://github.com/nastyandrianova/bdbd_labbs/blob/main/lab3/Andrianova_PMI_32_Chast_2.docx)

# Лабораторная работа №4
[Назад](#content)

Создать 4 различных [хранимых процедуры](https://github.com/nastyandrianova/bdbd_labbs/blob/main/lab4/%D0%A5%D1%80%D0%B0%D0%BD%D0%B8%D0%BC%D1%8B%D0%B5%20%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D0%B4%D1%83%D1%80%D1%8B.pdf):
1. Процедура без параметров, формирующая список свободных (не находящихся в прокате) автомобилей типа «внедорожник», года выпуска не старше 5 лет
2. Процедура, на входе получающая идентификатор автомобиля и формирующая список клиентов, которые брали его напрокат
3. Процедура, на входе получающая название модели, выходной параметр – ее рейтинг популярности
4. Процедура, вызывающая вложенную процедуру, которая находит самую дорогую сделку. Главная процедура формирует список, состоящий из ФИО клиента и моделей автомобилей, взятых напрокат в рамках этой сделки клиентом
	
Создать 3 [пользовательских функции](https://github.com/nastyandrianova/bdbd_labbs/blob/main/lab4/%D0%9F%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D0%BA%D0%B8%D0%B5%20%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%B8.pdf):
1. Скалярная функция, возвращающая среднее количество сделок в день
2. Inline-функция, возвращающая список автомобилей, которые находятся в данный момент в прокате в виде: идентификатор авто (напр., гос.регистрационный номер), модель, тип, ФИО клиента, срок возврата
3. Multi-statement-функция, выдающая выручку фирмы по месяцам заданного года
	
Создать 3 [триггера](https://github.com/nastyandrianova/bdbd_labbs/blob/main/lab4/%D0%A2%D1%80%D0%B8%D0%B3%D0%B3%D0%B5%D1%80%D1%8B%20.pdf):
1. Триггер любого типа на добавление сделки – если клиент когда-либо возвращал авто из проката не вовремя или в плохом состоянии, то сделка не заключается, в противном случае смотрим, сколько раз клиент пользовался нашими услугами, и в зависимости от этого делаем ему скидку при расчете суммы сделки
2. Последующий триггер на изменение стоимости проката автомобилей – стоимость проката можо менять только для автомобилей, которые в данный момент не находятся в прокате
3. Замещающий триггер на операцию удаления автомобиля – удалять можно только автомобили старше 15 лет, никогда не находившиеся в прокате, имеющие плохое состояние

<a id="lab5"></a>
# Лабораторная работа №5
[Назад](#content)

[Задание 1.](https://github.com/nastyandrianova/bdbd_labbs/blob/main/lab5/Task1.txt)
Для БД, созданной в Лаб.раб. 1-2, создать 2 роли:
- 1-я роль должна иметь доступ к таблицам, хр. процедурам и др. объектам БД, требующийся для руководителя фирмы (т.е., ему д.б. разрешено просматривать конфиденциальную информацию, удалять, исправлять какие-то сведения, выполнять процедуры и функции). Некоторые права необходимо предоставить с возможностью дальнейшей передачи.
- 2-я роль должна иметь доступ, требующийся для простого сотрудника (просмотр не всей инф-ии, добавление, изменение, удаление – только того, что нужно для работы, выполнение ограниченного набора процедур и функции).

Включить 2-х пользователей, предварительно созданных для каждого студента администратором БД, в эти роли и проверить, что права ролей выполняются для каждого пользователя (для этого под каждым пользователем подключиться к БД).
Необходимо уметь предоставлять права на объекты любого типа, отзывать выданные права, давать полный запрет на выполнение некоторых действий. (через команды T-SQL и интерфейс SQL Server Management Studio (SSMS))

[Задание 2.](https://github.com/nastyandrianova/bdbd_labbs/blob/main/lab5/Task2.txt)
Выполнить маскирование некоторых поле Ваших таблиц  2-мя различными методами:
1. ALTER COLUMN LastName ADD MASKED WITH (FUNCTION = 'partial(2,"xxxx",0)')
2. Используя механизмы представлений, хранимых процедур и функций. Члены 1 роли должны видеть оригинальные данные, члены 2 роли маскированные.


<a id="lab6"></a>
# Лабораторная работа №6
[Назад](#content)

Используя реляционную БД из лабораторной работы №2:
- продумать и создать графовые таблицы по реляционной БД, заполнить графовые таблицы, используя данные в реляционных таблицах
- написать запросы из задания 3.2 используя паттерн MATCH
- сравнить полученные результаты с результатами запросов к реляционной модели
- создать схему узлов и ребер

[SQL-код создания и заполнения графовых таблиц](https://github.com/nastyandrianova/bdbd_labbs/blob/main/lab6/Create%20graph%20tables.sql)

[Сравнение запросов](https://github.com/nastyandrianova/bdbd_labbs/blob/main/lab6/%D0%A1%D1%80%D0%B0%D0%B2%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D0%BE%D0%B2.pdf)

#### Схема узлов и ребер
![image](https://github.com/nastyandrianova/bdbd_labbs/blob/main/lab6/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA72.PNG)

# <a id="-lab1"></a><img src="https://github.com/user-attachments/assets/e080adec-6af7-4bd2-b232-d43cb37024ac" width="20" height="20"/> Lab7
[Назад](#content)
<h3 align="center"> Лабораторная работа №7 </h3>
<h3 align="center"> Транзакции </h3>
<h3> Теоретические сведения <h3>
<h3>
Изменения БД часто требуют выполнения нескольких запросов, например при покупке в электронном магазине требуется добавить запись в таблицу заказов и уменьшить число товарных позиций на складе. В промышленных БД одно событие может затрагивать большее число таблиц и требовать многочисленных запросов.
Если на этапе выполнения одного из запросов происходит сбой, это может нарушить целостность БД (товар может быть продан, а число товарных позиций на складе не обновлено). Чтобы сохранить целостность БД, все изменения должны выполняться как единое целое. Либо все изменения успешно выполняются, либо, в случае сбоя, БД принимает состояние, которое было до начала изменений. Это обеспечивается средствами обработки транзакций.
<h3>Задание 1<h3>
Используя базу, полученную в лабораторной 2, создать транзакцию, произвести ее откат и фиксацию. Показать, что данные существовали до отката, удалились после отката, снова были добавлены, и затем были успешно зафиксированы. При необходимости используйте точки сохранения и вложенные транзакции.
<h3>Задание 2<h3>
Подготовить SQL-скрипты для выполнения проверок изолированности транзакций. Ваши скрипты должны работать с одной из таблиц, созданных в лабораторной работе №2.
</h3>
 Выполнение:
	
[File](https://github.com/nastyandrianova/bdbd_labbs/blob/main/lab7/Лабораторная%20работа.Транзакции.pdf)
